<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Installation &mdash; Mona 1 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-2.2.1.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-responsive-2.2.1.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap-2.2.1.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Mona 1 documentation" href="index.html" />
    <link rel="next" title="Server Application" href="serverapp.html" />
    <link rel="prev" title="Samples" href="samples.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>
<div class="container">
  
  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a class="brand" href="index.html">Mona</a>
      <span class="navbar-text pull-left"><b>1</b></span>

      <div class="nav-collapse">
        <ul class="nav">
          <li class="divider-vertical"></li>
          
            <li class="dropdown">
  <a href="index.html" class="dropdown-toggle" data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="samples.html">Samples</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="serverapp.html">Server Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="scalability.html">Scalability and load-balancing</a></li>
<li class="toctree-l1"><a class="reference internal" href="serversocket.html">Server Application Sockets</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Mona Server&#8217;s lua API</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
</ul>
</li>
            <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Installation</a><ul>
<li><a class="reference internal" href="#binaries">Binaries</a></li>
<li><a class="reference internal" href="#download">Download</a></li>
<li><a class="reference internal" href="#build">Build</a></li>
<li><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li><a class="reference internal" href="#windows-build">Windows Build</a></li>
<li><a class="reference internal" href="#unix-build-linux-osx">Unix build (Linux/OSX)</a></li>
<li><a class="reference internal" href="#amazon-ec2-ami-install">Amazon EC2 AMI Install</a></li>
<li><a class="reference internal" href="#configurations">Configurations</a></li>
<li><a class="reference internal" href="#launch">Launch</a><ul>
<li><a class="reference internal" href="#start">Start</a></li>
<li><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
          
          
            
  <li><a href="samples.html"
         title="previous chapter">&laquo; Samples</a></li>
  <li><a href="serverapp.html"
         title="next chapter">Server Application &raquo;</a></li>
          
          
            <li>
  <a href="_sources/installation.txt"
     rel="nofollow">Source</a></li>
          
        </ul>

        
          
<form class="navbar-search pull-right" style="margin-bottom:-3px;" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        
      </div>
    </div>
  </div>

  
  <div class="section" id="installation">
<h1><a class="toc-backref" href="#id1">Installation</a><a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>We remind you that Mona is licensed under the <a class="reference external" href="http://www.gnu.org/licenses/">GNU General Public License</a>, so <strong>MonaBase can&#8217;t be linked with any closed source project</strong>.</p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#installation" id="id1">Installation</a><ul>
<li><a class="reference internal" href="#binaries" id="id2">Binaries</a></li>
<li><a class="reference internal" href="#download" id="id3">Download</a></li>
<li><a class="reference internal" href="#build" id="id4">Build</a></li>
<li><a class="reference internal" href="#dependencies" id="id5">Dependencies</a></li>
<li><a class="reference internal" href="#windows-build" id="id6">Windows Build</a></li>
<li><a class="reference internal" href="#unix-build-linux-osx" id="id7">Unix build (Linux/OSX)</a></li>
<li><a class="reference internal" href="#amazon-ec2-ami-install" id="id8">Amazon EC2 AMI Install</a></li>
<li><a class="reference internal" href="#configurations" id="id9">Configurations</a></li>
<li><a class="reference internal" href="#launch" id="id10">Launch</a><ul>
<li><a class="reference internal" href="#start" id="id11">Start</a></li>
<li><a class="reference internal" href="#usage" id="id12">Usage</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="binaries">
<h2><a class="toc-backref" href="#id2">Binaries</a><a class="headerlink" href="#binaries" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="download">
<h2><a class="toc-backref" href="#id3">Download</a><a class="headerlink" href="#download" title="Permalink to this headline">¶</a></h2>
<p>You can download entire sources in a <cite>zipball &lt;https://github.com/MonaSolutions/MonaServer/zipball/master&gt;</cite> way or use a client <a class="reference external" href="http://en.wikipedia.org/wiki/Git_(software)">GIT</a> with the following address: <a class="reference external" href="https://github.com/MonaSolutions/MonaServer.git">https://github.com/MonaSolutions/MonaServer.git</a>.</p>
</div>
<div class="section" id="build">
<h2><a class="toc-backref" href="#id4">Build</a><a class="headerlink" href="#build" title="Permalink to this headline">¶</a></h2>
<p>Mona source code is cross-platform.
In any case, you have to build <strong>MonaBase</strong> project in first, then <strong>MonaCore</strong> and then <strong>MonaServer</strong>.</p>
</div>
<div class="section" id="dependencies">
<h2><a class="toc-backref" href="#id5">Dependencies</a><a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>Mona has the following dependencies:
- <a class="reference external" href="http://www.openssl.org/">OpenSSL</a> is required.
- <a class="reference external" href="http://luajit.org/">LuaJIT</a> is required.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="http://luajit.org/">LuaJIT</a> is an alternative to the officiel LUA interpreter. It works really faster than LUA essentially because it compiles the LUA code to machine code during execution (see <cite>LuaJIT performance &lt;http://luajit.org/performance_x86.html&gt;</cite> about performance comparaison).</p>
</div>
</div>
<div class="section" id="windows-build">
<h2><a class="toc-backref" href="#id6">Windows Build</a><a class="headerlink" href="#windows-build" title="Permalink to this headline">¶</a></h2>
<p>Visual Studio 2013 solution and project files are included.
It searchs external librairies in <em>External/lib</em> folder and external includes in <em>External/include</em> folder in the root <em>Mona</em> folder.
So you must put <a class="reference external" href="http://www.openssl.org/">OpenSSL</a> and <a class="reference external" href="http://luajit.org/">LuaJIT</a> headers and libraries in these folders.
You can find <a class="reference external" href="http://www.openssl.org/">OpenSSL</a> binaries for windows on <a class="reference external" href="http://www.slproweb.com/products/Win32OpenSSL.html">Win32OpenSSL</a>.</p>
</div>
<div class="section" id="unix-build-linux-osx">
<h2><a class="toc-backref" href="#id7">Unix build (Linux/OSX)</a><a class="headerlink" href="#unix-build-linux-osx" title="Permalink to this headline">¶</a></h2>
<p>If your Unix system includes a package manager you can install quickly <a class="reference external" href="http://www.openssl.org/">OpenSSL</a> and <a class="reference external" href="http://luajit.org/">LuaJIT</a>.
Packages are usually named <em>libssl-dev</em> and <em>libluajit-5.1-dev</em>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Use their <em>-dev</em> version to get header files required during Mona compilation.</p>
</div>
<p>Then, Mona built steps are easy:</p>
<div class="highlight-sh"><div class="highlight"><pre>      <span class="nb">cd </span>MonaBase
      make
<span class="nb">cd</span> ../MonaCore
      make
      <span class="nb">cd</span> ../MonaServer
      make
</pre></div>
</div>
<p>To clean all, steps are naturally:</p>
<div class="highlight-sh"><div class="highlight"><pre>      <span class="nb">cd </span>MonaBase
      make clean
<span class="nb">cd</span> ../MonaCore
      make clean
      <span class="nb">cd</span> ../MonaServer
      make clean
</pre></div>
</div>
</div>
<div class="section" id="amazon-ec2-ami-install">
<h2><a class="toc-backref" href="#id8">Amazon EC2 AMI Install</a><a class="headerlink" href="#amazon-ec2-ami-install" title="Permalink to this headline">¶</a></h2>
<p>Create a standard EC2 AMI with a new security group. Open up all UDP and at least TCP Ports 1935 in the Security Group.</p>
<p>Connect to the AMI and execute the following script:</p>
<div class="highlight-sh"><div class="highlight"><pre>      sudo -s
      yum -y groupinstall <span class="s2">&quot;Development Tools&quot;</span>
      yum -y groupinstall <span class="s2">&quot;Development Libraries&quot;</span>
      yum -y install make
      wget http://luajit.org/download/LuaJIT-2.0.0.tar.gz
      tar zxf LuaJIT-2.0.0.tar.gz
      <span class="nb">cd </span>LuaJIT-2.0.0
      make
      sudo make install
      wget https://github.com/MonaSolutions/MonaServer/archive/master.zip
      unzip Mona-master.zip
      <span class="nb">cd </span>Mona-master
      <span class="nb">cd </span>MonaBase
      make
<span class="nb">cd</span> ..
      <span class="nb">cd </span>MonaCore
make
      <span class="nb">cd</span> ..
      <span class="nb">cd </span>MonaServer
      make
      sudo ./MonaServer --daemon
</pre></div>
</div>
</div>
<div class="section" id="configurations">
<h2><a class="toc-backref" href="#id9">Configurations</a><a class="headerlink" href="#configurations" title="Permalink to this headline">¶</a></h2>
<p>MonaServer is statically configured by an optional configuration <em>MonaServer.ini</em> file to put in the installation folder.
Possible configurations are:</p>
<ul class="simple">
<li><strong>port</strong> : equals 1935 by default (RTMFP server default port), it&#8217;s the port used by MonaServer to listen incoming RTMFP requests.</li>
<li><strong>udpBufferSize</strong> : allows to change the size in bytes of UDP reception and sending buffer. Increases this value if your operating system has a default value too lower for important loads.</li>
<li><strong>threads</strong> : indicates the number of threads which will be allocated in the pool of threads of Mona. Usually it have to be equal to (or greather than) the number of cores on the host machine (virtual or physic cores). By default, an auto-detection system tries to determinate its value, but it can be perfectible on machine who owns hyper-threading technology, or on some operating systems.</li>
<li><strong>keepAliveServer</strong> : time in seconds for periodically sending packets keep-alive with server, 15s by default (valid value is from 5s to 255s).</li>
<li><strong>keepAlivePeer</strong> : time in seconds for periodically sending packets keep-alive between peers, 10s by default (valid value is from 5s to 255s).</li>
<li><strong>publicAddress</strong> : address like it will be seen by clients, this option is mandatory to make working all redirection features in multiple server configuration (see <cite>Scalability and load-balancing &lt;./scalability.html&gt;</cite>).</li>
<li><strong>servers.port</strong> : port to receive incoming server connection (in a multiple servers configuration, see <cite>Scalability and load-balancing &lt;./scalability.html&gt;</cite> for more details). If you don&#8217;t configure this port, no one MonaServer can etablish a connection therewith it.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Exchange between servers is done in a uncrypted TCP way, so to avoid an attack by this incoming end point the <em>servers.port</em> should be protected by a firewall to allow just a connection by an other server and nothing else.</p>
</div>
<ul class="simple">
<li><strong>servers.targets</strong> : list of MonaServer addresses (separated by semicolons) to connect on start-up. When the server will start, it will try to etablish a connection to these addresses every 10 seconds (see <cite>Scalability and load-balancing &lt;./scalability.html&gt;</cite> for more details). Each token can include arguments through as a query url form:</li>
</ul>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[servers]</span>
<span class="na">targets</span><span class="o">=</span><span class="s">192.168.0.2:1936?name=master&amp;arg=val;192.168.0.3:1936</span>
</pre></div>
</div>
<p>It will create dynamic properties on <em>server</em> object (see <em>server</em> object description of &#8220;Server application, api&#8221; page for more details).</p>
<div class="highlight-lua"><div class="highlight"><pre><span class="k">function</span> <span class="nf">onServerConnection</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">server</span><span class="p">.</span><span class="n">name</span><span class="o">==</span><span class="s2">&quot;</span><span class="s">master&quot;</span> <span class="k">then</span> <span class="c1">-- true here just for 192.168.0.2:1936 server</span>
                <span class="n">NOTE</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">server master arg = &quot;</span><span class="o">..</span><span class="n">server</span><span class="p">.</span><span class="n">arg</span><span class="p">)</span> <span class="c1">-- displays here &quot;server master arg = val&quot;</span>
        <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>smtp.host</strong> : configure a SMTP host to use mails feature provided by Mona in server application (see <cite>Server application, Sockets &lt;./serversocket.html&gt;</cite> page for more details about mails feature). By default the value is <em>localhost</em>.</li>
<li><strong>smtp.port</strong> : configure a SMTP port to use mails feature provided by Mona in server application (see <cite>Server application, Sockets &lt;./serversocket.html&gt;</cite> page for more details about mails feature). By default the value is 25.</li>
<li><strong>smtp.timeout</strong> : configure a SMTP timeout session in seconds to use mails feature provided by Mona in server application (see <cite>Server application, Sockets &lt;./serversocket.html&gt;</cite> page for more details about mails feature). By default the value is 60 seconds.</li>
<li><strong>logs.directory</strong> : directory where are written log files (<em>MonaServer/logs</em> by default).</li>
<li><strong>logs.name</strong> : name of log file (<em>log</em> by default).</li>
</ul>
<div class="highlight-ini"><div class="highlight"><pre><span class="c1">;MonaServer.ini</span>
<span class="na">port</span> <span class="o">=</span> <span class="s">1985</span>
<span class="na">udpBufferSize</span> <span class="o">=</span> <span class="s">114688</span>
<span class="na">keepAlivePeer</span> <span class="o">=</span> <span class="s">10</span>
<span class="na">keepAliveServer</span> <span class="o">=</span> <span class="s">15</span>
<span class="k">[logs]</span>
<span class="na">name</span><span class="o">=</span><span class="s">log</span>
<span class="na">directory</span><span class="o">=</span><span class="s">C:/MonaServer/logs</span>
</pre></div>
</div>
<p>If this configuration file doesn&#8217;t exist, default values are used.</p>
</div>
<div class="section" id="launch">
<h2><a class="toc-backref" href="#id10">Launch</a><a class="headerlink" href="#launch" title="Permalink to this headline">¶</a></h2>
<div class="section" id="start">
<h3><a class="toc-backref" href="#id11">Start</a><a class="headerlink" href="#start" title="Permalink to this headline">¶</a></h3>
<p>MonaServer includes some argument launch options, but by default MonaServer is optimized for a production running. Command-line options are useful during development and test usage. To get full description about launch arguments start MonaServer with <em>/help</em> argument on Windows or <em>&#8211;help</em> on Unix system.</p>
<p>Otherwise, starts simply MonaServer application with administrative rights.</p>
<p>You can also start it as a Windows service:</p>
<div class="highlight-sh"><div class="highlight"><pre>MonaServer.exe /registerService <span class="o">[</span>/displayName<span class="o">=</span>MonaServer /description<span class="o">=</span><span class="s2">&quot;Open Source RTMFP Server&quot;</span> /startup<span class="o">=</span>automatic<span class="o">]</span>
</pre></div>
</div>
<p>Or an Unix daemon:</p>
<div class="highlight-sh"><div class="highlight"><pre>sudo ./MonaServer --daemon <span class="o">[</span>--pidfile<span class="o">=</span>/var/run/MonaServer.pid<span class="o">]</span>
</pre></div>
</div>
</div>
<div class="section" id="usage">
<h3><a class="toc-backref" href="#id12">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p>Flash client connects to MonaServer by the classical NetConnection way:</p>
<div class="highlight-as3"><div class="highlight"><pre><span class="n">_netConnection</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="s2">&quot;rtmfp://localhost/&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>Here the port has its default value 1935. If you configure a different port on MonaServer you have to indicate this port in the URL (after <em>localhost</em>, of course).</p>
<p>The path used allows you to connect for your desired <cite>Server Application &lt;./serveapp.html&gt;</cite>.</p>
<div class="highlight-as3"><div class="highlight"><pre><span class="n">_netConnection</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="s2">&quot;rtmfp://localhost/myApplication&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>To go more further, see <cite>Server Application &lt;./serveapp.html&gt;</cite> or <cite>Samples &lt;./samples.html&gt;</cite> page.</p>
</div>
</div>
</div>


</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, Mathieu Poux &amp; Thomas Jammet.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2b2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>